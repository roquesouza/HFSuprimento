<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<f:view xmlns:f="http://java.sun.com/jsf/core" contentType="text/html" encoding='UTF-8'>
	<html xmlns="http://www.w3.org/1999/xhtml" xmlns:h="http://java.sun.com/jsf/html" xmlns:p="http://primefaces.org/ui" xmlns:ui="http://java.sun.com/jsf/facelets">

<h:head>
	<title>HFSuprimento - Sistema de Cotação - SM Consultoria</title>
	<link type="text/css" rel="stylesheet" href="#{request.contextPath}/resources/css/geral.css" />

	<script>
		function MaskMonetario(v) {
			v = v.replace(/\D/g, ""); // Remove tudo o que n�o � d�gito
			v = v.replace(/(\d{2})$/, ",$1"); // Coloca a virgula
			v = v.replace(/(\d+)(\d{3},\d{2})$/g, "$1.$2"); // Coloca o primeiro ponto
			var qtdLoop = (v.length - 3) / 3;
			var count = 0;
			while (qtdLoop > count) {
				count++;
				v = v.replace(/(\d+)(\d{3}.*)/, "$1.$2"); // Coloca o resto dos pontos
			}
			v = v.replace(/^(0)(\d)/g, "$2"); // Coloca h�fen entre o quarto e o
			// quinto d�gitos
			return v;
		}
		function mascaraMoeda(campo) {
			campo.value = MaskMonetario(campo.value);
		}
	</script>

</h:head>

<h:body id="bodyDashBoard" style="#{cotacaoProdutoFornecedorFaces.cotacaoProdutoFornecedorModel != null ? 'font-size: 11px' : ''}">

	<h:panelGroup rendered="#{cotacaoProdutoFornecedorFaces.cotacaoProdutoFornecedorModel == null}">
		<ui:include src="erro.html" />
	</h:panelGroup>
	
	<h:form id="tabsCRUD" prependId="false" rendered="#{cotacaoProdutoFornecedorFaces.cotacaoProdutoFornecedorModel != null}" >

		<p:growl autoUpdate="true" showDetail="true" showSummary="false" />
		
		<p:layout fullPage="true">

			<p:layoutUnit id="areaTrabalho" header="Fornecedor: #{cotacaoProdutoFornecedorFaces.cotacaoProdutoFornecedorModel.fornecedorModel.nomeFantasia}" position="center">

				<h:panelGrid columns="1" style="width: 100%">

					<p:fieldset legend="PRODUTOS DA COTAÇÃO Nº #{cotacaoProdutoFornecedorFaces.cotacaoProdutoFornecedorModel.cotacaoProdutoModel.cotacaoModel.id}" style="width: 98%">

						<p:dataTable id="gridPesquisa" value="#{cotacaoProdutoFornecedorFaces.cotacaoProdutoFornecedorModel.grid}" var="linha" emptyMessage="Nenhum item encontrado">

							<p:column styleClass="coluna30" headerText="Produto">
								<h:outputLabel value="#{linha.cotacaoProdutoModel.produtoModel.nomePrincipal}" />
							</p:column>

							<p:column styleClass="coluna10" headerText="Unidade">
								<h:outputLabel value="#{linha.cotacaoProdutoModel.produtoModel.unidadeMedidaModel.descricao}" />
							</p:column>
							
							<p:column headerText="Detalhe" styleClass="coluna10">
								<h:outputText value="#{linha.cotacaoProdutoModel.observacao}" />
							</p:column>

							<p:column styleClass="coluna10" headerText="Quantidade">
								<h:outputLabel value="#{linha.cotacaoProdutoModel.quantidadeSolicitada}">
									<f:convertNumber type="number" pattern="#,###,##0.##" locale="pt_BR" />
								</h:outputLabel>
							</p:column>

							<p:column styleClass="coluna10" headerText="Valor Unitário (R$)">
								<p:inputText id="valor" value="#{linha.valor}" disabled="true" style="width: 90%;">
									<f:convertNumber type="number" pattern="###,###,##0.00##" locale="pt_BR" />
								</p:inputText>
							</p:column>

							<p:column styleClass="coluna10" headerText="Valor Total (R$)">
								<p:inputText id="valorTotal" value="#{linha.valorTotal}" onkeyup="return mascaraMoeda(this)" style="width: 90%;">
									<f:convertNumber type="number" pattern="###,###,##0.00" locale="pt_BR" />
									<p:ajax global="false" event="blur" listener="#{cotacaoProdutoFornecedorFaces.calcularValorUnitario(linha)}" process="@this" update=":tabsCRUD:gridPesquisa:valor" />
								</p:inputText>
							</p:column>

							<p:column headerText="Fabricante" styleClass="coluna15">
								<h:selectOneMenu value="#{linha.fabricanteModel.id}" styleClass="combo" style="width:95%">
									<f:selectItem itemLabel="Não selecionado" itemValue="" />
									<f:selectItems value="#{linha.cotacaoProdutoModel.produtoModel.fabricantesAutorizados}" var="fab" itemLabel="#{fab.nome}" itemValue="#{fab.id}" />
								</h:selectOneMenu>
							</p:column>

							<p:column headerText="Obs." styleClass="coluna15">
								<p:inputTextarea value="#{linha.observacao}" maxlength="995" rows="2" autoResize="false" style="width: 98%" />
							</p:column>

						</p:dataTable>

						<p:commandButton type="button" rendered="#{!empty cotacaoProdutoFornecedorFaces.cotacaoProdutoFornecedorModel.grid}" id="btnSalvar" value="Gravar" icon="salvar" onclick="cdAlterar.show()" style="margin-top: 10px" />

					</p:fieldset>
					
					<h:outputText value="Atenção Fornecedor! Depois de preencher os valores, envie-nos sua cotação em papel timbrado para que possamos anexá-la ao processo." style="font-size: 16px; font-weight: bold"/>

				</h:panelGrid>

			</p:layoutUnit>

			<p:confirmDialog message="Confirma gravação da cotação?" header="Aviso" severity="alert" widgetVar="cdAlterar" modal="true">
				<p:commandButton global="true" value="Sim" onclick="cdAlterar.hide()" action="#{cotacaoProdutoFornecedorFaces.updateEvent}" />
				<p:commandButton value="Nao" onclick="cdAlterar.hide()" />
			</p:confirmDialog>

		</p:layout>

	</h:form>

</h:body>
	</html>
</f:view>